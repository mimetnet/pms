MFLAGS = $(DEBUG_FLAGS) $(TIMEOUT_FLAGS) -nologo -d:$(MONO_VERSION) -keyfile:$(top_srcdir)/src/sec.snk

noinst_SCRIPTS = $(ASSEMBLY)

SOURCES_make = $(top_srcdir)/src/bin/$(ASSEMBLY).make
SOURCES_file = $(top_srcdir)/src/bin/$(ASSEMBLY).sources

CLEANFILES = $(ASSEMBLY) $(ASSEMBLY).mdb $(SOURCES_file) $(SOURCES_make)
EXTRA_DIST = $(SOURCES) $(subst .dll,.csproj,$(ASSEMBLY))

$(ASSEMBLY): $(SOURCES) $(SOURCES_file)
	$(MCS) $(MFLAGS) -target:library -out:$@ $(REFERENCES) @$(SOURCES_file)

$(SOURCES_file):
	find . -name '*.cs' -type f > $@;

$(SOURCES_make):
	for f in `find . -name '*.cs' -type f`; do echo $(ASSEMBLY): $$f >> $@; done;

install-data-local:
	$(GACUTIL) $(GACUTIL_FLAGS) -check_refs -i $(ASSEMBLY)
	$(install_sh) -d $(DESTDIR)$(purdydir)
	$(install_sh_DATA) -t $(DESTDIR)$(purdydir)/ $(ASSEMBLY)

uninstall-local:
	$(GACUTIL) $(GACUTIL_FLAGS) -u $(subst .dll,,$(ASSEMBLY))
	rm $(DESTDIR)$(purdydir)/$(ASSEMBLY)

-include $(SOURCES_make)
